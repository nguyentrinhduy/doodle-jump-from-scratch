(()=>{"use strict";const t=800,e=648;class s{constructor(t){this.loaded=!1,this.image=new Image;let e="./assets/Images/";e+=t.join("/"),e+=".png",this.image.src=e}getNaturalSize(){return[this.image.width,this.image.height]}display(t,e){const s=document.getElementById("game").getContext("2d");s&&s.drawImage(this.image,t[0],t[1],e[0],e[1])}}const i=["Backgrounds","background"],o=["Backgrounds","pause_screen"],n=["Backgrounds","top"],h=["Backgrounds","bottom"],a=["Backgrounds","main_menu"],r=["Player","left"],l=["Player","right"],c=["Player","left_jump"],u=["Player","right_jump"],p=["Player","shoot"],d=["Buttons","play"],y=["Buttons","pause"],g=["Buttons","play_again"],m=["Buttons","resume"],f=["Lands","normal_land"],b=["Lands","moving_land"],P=["Lands","dust_land"],S=["Buff","propeller_buff"],B=["Buff","jetpack_buff"],w=["Buff","spring_buff"],k=["Bullet","bullet"],v=["Components","game_over"],O=["Buttons","menu"],I=["Monsters","blue_wing_monster"],R=["Monsters","alien_monster"],z=[i,o,n,a,r,l,c,u,p,d,["Buttons","play_hover"],y,["Buttons","options"],["Buttons","play_again_hover"],g,m,f,b,v,O,k,p],A=[[S,4],[B,10],[w,2],[P,4],[I,8],[R,2]];class L{constructor(){this.Sprites={},this.animationSprites={};for(const t of z)this.Sprites[this.getKey(t)]=new s(t);for(const t of A){let e=[];for(let i=0;i<t[1];i++){let o=[...t[0]];o.push(i.toString()),e.push(new s(o))}this.animationSprites[this.getKey(t[0])]=e}}static getInstance(){return L.instance||(L.instance=new L),L.instance}getKey(t){return t.join("_")}getSprite(t){const e=this.getKey(t);return e in this.Sprites||(this.Sprites[e]=new s(t)),this.Sprites[e]}getAnimationSprite(t){const e=this.getKey(t);if(!(e in this.animationSprites))throw new Error("The desired animation sprite does not exist");return this.animationSprites[e]}}class x{transitionTo(t){this.currentScene=t,this.currentScene.setContext(this)}constructor(){this.spriteFactory=L.getInstance(),this.loop=this.loop.bind(this)}run(){this.lastTime=window.performance.now(),requestAnimationFrame(this.loop)}loop(){let t=window.performance.now(),e=t-this.lastTime;this.currentScene.processInput(),this.currentScene.update(e),this.currentScene.render(),this.lastTime=t,requestAnimationFrame(this.loop)}}class T{constructor(){this.offset=[0,0],this.size=[e,t],this.focusedObject=null,this.topBound=-1/0,this.bottomBound=1/0,this.leftBound=-1/0,this.rightBound=1/0}isOutOfRange(t){return this.isOutOfTopRange(t)&&this.isOutOfBottomRange(t)&&this.isOutOfLeftRange(t)&&this.isOutOfRightRange(t)}isOutOfTopRange(t){let e=t.getPosition(),s=t.getSize();return e[1]+s[1]<this.offset[1]}isOutOfBottomRange(t){return t.getPosition()[1]>this.offset[1]+this.size[1]}isOutOfLeftRange(t){let e=t.getPosition(),s=t.getSize();return e[0]+s[0]<this.offset[0]}isOutOfRightRange(t){return t.getPosition()[0]>this.offset[0]+this.size[0]}update(){this.focusedObject&&(this.focusedObject.getPositionY()<=this.offset[1]+this.topBound&&(this.offset[1]=this.focusedObject.getPositionY()-this.topBound),this.focusedObject.getPositionY()>=this.offset[1]+this.bottomBound&&(this.offset[1]=this.focusedObject.getPositionY()-this.bottomBound),this.focusedObject.getPositionX()<=this.offset[0]+this.leftBound&&(this.offset[0]=this.focusedObject.getPositionX()-this.leftBound),this.focusedObject.getPositionX()>=this.offset[0]+this.rightBound&&(this.offset[0]=this.focusedObject.getPositionX()-this.rightBound))}setTopBound(t){this.topBound=t}setBottomBound(t){this.bottomBound=t}setLeftBound(t){this.leftBound=t}setRightBound(t){this.rightBound=t}focusOn(t){this.focusedObject=t}getOffset(){return this.offset}getOffsetX(){return this.offset[0]}getOffsetY(){return this.offset[1]}setOffsetX(t){this.offset[0]=t}setOffsetY(t){this.offset[1]=t}setOffset(t){this.offset=t}}var H,M;!function(t){t[t.Jump=0]="Jump",t[t.ShootUp=1]="ShootUp",t[t.ShootDown=2]="ShootDown",t[t.Fall=3]="Fall",t[t.WearingJetpack=4]="WearingJetpack",t[t.WearingPropeller=5]="WearingPropeller",t[t.Lose=6]="Lose"}(H||(H={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right"}(M||(M={}));class V{constructor(){this.visible=!0}setSize(t){this.size=t}setWidth(t){this.size[1]=t}setHeight(t){this.size[1]=t}setPosition(t){this.position=t}setPositionX(t){this.position[0]=t}setPositionY(t){this.position[1]=t}scaleSize(t){this.size[0]*=t,this.size[1]*=t}getSize(){return this.size}getWidth(){return this.size[0]}getHeight(){return this.size[1]}getPosition(){return this.position}getPositionX(){return this.position[0]}getPositionY(){return this.position[1]}isVisible(){return this.visible}setVisible(t){this.visible=t}containsPoint(t){return this.position[0]<=t[0]&&t[0]<=this.position[0]+this.size[0]&&this.position[1]<=t[1]&&t[1]<=this.position[1]+this.size[1]}collides(t){return this.containsPoint(t.position)||this.containsPoint([t.position[0],t.position[1]+t.size[1]])||this.containsPoint([t.position[0]+t.size[0],t.position[1]])||this.containsPoint([t.position[0]+t.size[0],t.position[1]+t.size[1]])}standOn(t){return t.containsPoint([this.position[0],this.position[1]+this.size[1]])||t.containsPoint([this.position[0]+this.size[0],this.position[1]+this.size[1]])}}class D extends V{constructor(t){super(),this.sprite=L.getInstance().getSprite(t),this.size=this.sprite.getNaturalSize()}setSprite(t){this.sprite=L.getInstance().getSprite(t)}display(t=[0,0]){this.visible&&this.sprite.display([this.position[0]-t[0],this.position[1]-t[1]],this.size)}}class F extends D{constructor(t,e){super(k),this.position=t,this.velocity=e}move(t){this.position[0]+=this.velocity[0]*t,this.position[1]+=this.velocity[1]*t}}const j=[0,-.95],Y=[70,810],E=[0,0],J=[100,-100],X=[0,-1.5],N=[0,.0015],W=[0,-2],C=[40,30];class K{constructor(t){this.AppliedObject=t,this.gravity_acceleration=[...N],this.isAppliedPhysics=!0}setEnable(t){this.isAppliedPhysics=t}isEnabled(){return this.isAppliedPhysics}getVelocity(){return this.velocity}setVelocity(t){this.velocity=t}getVelocityX(){return this.velocity[0]}setVelocityX(t){this.velocity[0]=t}getVelocityY(){return this.velocity[1]}setVelocityY(t){this.velocity[1]=t}update(t){if(!this.AppliedObject)return;let e=this.AppliedObject.getPosition();e[0]+=this.velocity[0]*t,e[1]+=this.velocity[1]*t,this.isAppliedPhysics&&(this.velocity[0]+=this.gravity_acceleration[0]*t,this.velocity[1]+=this.gravity_acceleration[1]*t)}clone(t){let e=new K(t);return e.velocity=[...this.velocity],e.isAppliedPhysics=this.isAppliedPhysics,e}}class U extends D{constructor(){super(c),this.position=[...Y],this.state=H.Jump,this.direction=M.Left,this.specialStateTime=0,this.scaleSize(1.5),this.physicsHandler=new K(this),this.physicsHandler.setVelocity([...X])}resolveBuffPosition(){this.buff&&(this.state==H.WearingPropeller?this.buff.setPosition([this.position[0]+15,this.position[1]]):this.state==H.WearingJetpack&&(this.direction==M.Left?this.buff.setPosition([this.position[0]+this.size[0]-30,this.position[1]+20]):this.buff.setPosition([this.position[0]-this.buff.getWidth()+30,this.position[1]+20])))}autoFall(t){this.physicsHandler.update(t),this.specialStateTime>0&&(this.specialStateTime-=t,this.specialStateTime<=0?(this.specialStateTime=0,this.buff=null,this.setState(H.Jump),this.physicsHandler.setEnable(!0)):this.buff&&(this.buff.timePassed(t),this.resolveBuffPosition())),this.physicsHandler.getVelocityY()>=0&&this.state==H.Jump&&this.setState(H.Fall)}setVelocityDirection(t){this.direction=t,this.setState(this.state),t===M.Left?this.physicsHandler.setVelocityX(-.4):this.physicsHandler.setVelocityX(.4)}setVelocity(t){this.physicsHandler.setVelocity(t)}setVelocityX(t){this.physicsHandler.setVelocityX(t)}getVelocityX(){return this.physicsHandler.getVelocityX()}setVelocityY(t){this.physicsHandler.setVelocityY(t)}getVelocityY(){return this.physicsHandler.getVelocityY()}applyGravity(t){this.physicsHandler.setEnable(t)}getVelocity(){return this.physicsHandler.getVelocity()}getState(){return this.state}update(t){this.autoFall(t)}setBuffTime(t){this.specialStateTime=t}setBuff(t){this.buff=t}getBuff(){return this.buff}setPositionX(t){super.setPositionX(t),this.resolveBuffPosition()}setPosition(t){super.setPosition(t),this.resolveBuffPosition()}setPositionY(t){super.setPositionY(t),this.resolveBuffPosition()}setState(t,e=this.direction){switch(this.state=t,this.direction=e,this.state){case H.Jump:e==M.Left?this.setSprite(c):this.setSprite(u);break;case H.ShootUp:this.setSprite(p);break;default:e==M.Right?this.setSprite(l):this.setSprite(r)}}setSpecialStateTime(t){this.specialStateTime=t}shoot(t){return new F([this.position[0]+C[0],this.position[1]+C[1]],t)}autoFallInStartScene(t){this.physicsHandler.update(t),this.physicsHandler.getVelocityY()>=0&&this.state==H.Jump&&this.setState(H.Fall)}display(t=[0,0]){super.display(t),this.buff&&this.buff.display(t)}clone(){let t=new U;return t.position=[...this.position],t.size=[...this.size],t.visible=this.visible,t.state=this.state,t.direction=this.direction,t.physicsHandler=this.physicsHandler.clone(t),t.specialStateTime=this.specialStateTime,t.sprite=this.sprite,this.buff?t.buff=this.buff.clone():t.buff=null,t}}class _{constructor(){this.highScore=0,this.reset()}reset(){this.player=new U,this.camera=new T,this.camera.focusOn(this.player),this.camera.setTopBound(300),this.lands=[],this.bullets=[],this.monsters=[],this.playerName="Unknown Player",this.score=0}static getInstance(){return _.instance||(_.instance=new _),_.instance}setPlayer(t){this.player=t,this.camera.focusOn(this.player)}getPlayer(){return this.player}getLands(){return this.lands}getMonsters(){return this.monsters}getBullets(){return this.bullets}getCamera(){return this.camera}getScore(){return this.score}getPlayerName(){return this.playerName}setScore(t){this.score=t,this.highScore=Math.max(this.highScore,this.score)}getHighScore(){return this.highScore}}class q extends D{isClicked(t,e){return this.containsPoint([t,e])}}class G{constructor(t){this.range=null,this.sprites=t,this.currentAnimation=0,this.timeDifference=0,this.animationTimeLeft=0}setTimeDifference(t){this.timeDifference=t}setTimeDisplay(t){this.timeDisplay=t}setRangeAnimation(t){this.range=t}setCurrenAnimation(t){this.currentAnimation=t}timePassed(t){this.range&&this.currentAnimation==this.range[1]||0!=this.timeDifference&&(this.animationTimeLeft-=t,this.animationTimeLeft<=0&&(this.animationTimeLeft=this.timeDifference,this.currentAnimation++,this.currentAnimation>=this.sprites.length&&(this.currentAnimation=0)))}getNaturalSize(){return this.sprites[this.currentAnimation].getNaturalSize()}display(t,e){this.sprites[this.currentAnimation].display(t,e)}clone(){let t=new G(this.sprites);return t.currentAnimation=this.currentAnimation,t.timeDifference=this.timeDifference,t.animationTimeLeft=this.animationTimeLeft,t.timeDisplay=this.timeDisplay,this.range?t.range=[...this.range]:t.range=null,t}}class Q extends V{constructor(t){super(),this.spritesName=[...t],this.animator=new G(L.getInstance().getAnimationSprite(t)),this.size=this.animator.getNaturalSize()}requestLoopAnimation(){this.animator.setRangeAnimation(null),this.animator.setCurrenAnimation(0),this.animator.setTimeDifference(30)}requestSingleAnimation(t){this.animator.setTimeDifference(0),this.animator.setCurrenAnimation(t),this.animator.setRangeAnimation(null),this.size=this.animator.getNaturalSize()}requestMultipleAnimation(t,e){this.animator.setCurrenAnimation(t),this.animator.setRangeAnimation([t,e]),this.animator.setTimeDifference(30)}timePassed(t){this.animator.timePassed(t)}display(t=[0,0]){this.visible&&this.animator.display([this.position[0]-t[0],this.position[1]-t[1]],this.size)}cloneAnimator(){return this.animator.clone()}setAnimator(t){this.animator=t}}var Z;!function(t){t[t.None=0]="None",t[t.Propeller=1]="Propeller",t[t.Jetpack=2]="Jetpack",t[t.Spring=3]="Spring"}(Z||(Z={}));class $ extends Q{constructor(t){super(t),this.requestSingleAnimation(0),this.scaleSize(2)}}const tt=[0,-1.3],et=[0,-1.1],st=[0,-1.3];class it extends ${constructor(){super(S)}onReceived(t){t.setVelocity([...et]),t.applyGravity(!1),t.setState(H.WearingPropeller),t.setBuffTime(1e3),t.setBuff(this),this.requestLoopAnimation()}clone(){let t=new it;return t.position=[...this.position],t.size=[...this.size],t.visible=this.visible,t.setAnimator(this.cloneAnimator()),t}}class ot extends ${constructor(){super(B)}onReceived(t){t.setVelocity([...st]),t.applyGravity(!1),t.setState(H.WearingJetpack),t.setBuffTime(1e3),t.setBuff(this),this.requestLoopAnimation()}clone(){let t=new ot;return t.position=[...this.position],t.size=[...this.size],t.visible=this.visible,t.setAnimator(this.cloneAnimator()),t}}class nt extends ${constructor(){super(w)}onReceived(t){t.setState(H.Jump),t.setVelocity([...tt]);let e=[this.position[0],this.position[1]+this.size[1]];this.requestSingleAnimation(1),this.scaleSize(2),this.position=[e[0],e[1]-this.size[1]]}clone(){let t=new nt;return t.position=[...this.position],t.size=[...this.size],t.visible=this.visible,t.setAnimator(this.cloneAnimator()),t}}class ht{constructor(){this.Speed=60}static getInstance(){return ht.instance||(ht.instance=new ht),ht.instance}getRandomInt(t,e){const s=Math.ceil(t),i=Math.floor(e);return Math.floor(Math.random()*(i-s)+s)}getRandomFloat(t,e){return Math.random()*(e-t)+t}}class at extends D{constructor(){super(f),this.scaleSize(2)}setPositionForBuff(){let t=ht.getInstance();this.buff.setPosition([this.position[0]+t.getRandomFloat(0,this.size[0]-this.buff.getWidth()),this.position[1]-this.buff.getHeight()])}randomizeBuff(){switch(ht.getInstance().getRandomInt(0,30)){case Z.Propeller:this.buff=new it,this.setPositionForBuff();break;case Z.Jetpack:this.buff=new ot,this.setPositionForBuff();break;case Z.Spring:this.buff=new nt,this.setPositionForBuff()}}onJumped(t){this.buff&&t.collides(this.buff)?this.buff.onReceived(t):(t.setVelocity([...j]),t.getState()!=H.ShootUp&&t.setState(H.Jump))}move(t){}display(t){super.display(t),this.buff&&this.buff.display(t)}}class rt{constructor(){this.keyDownEventListener=t=>{this.keyDownInput[this.mapKey[t.key]]=!0,this.keyUpInput[this.mapKey[t.key]]=!1},this.keyUpEventListener=t=>{this.keyDownInput[this.mapKey[t.key]]=!1,this.keyUpInput[this.mapKey[t.key]]=!0},this.keyDownInput={},this.keyUpInput={},this.mapKey={},this.mapKey.w="w",this.mapKey.ArrowUp="w",this.mapKey.a="a",this.mapKey.ArrowLeft="a",this.mapKey.s="s",this.mapKey.ArrowDown="s",this.mapKey.d="d",this.mapKey.ArrowRight="d",window.addEventListener("keydown",this.keyDownEventListener),window.addEventListener("keyup",this.keyUpEventListener)}keyDown(t){return this.mapKey[t]in this.keyDownInput&&this.keyDownInput[this.mapKey[t]]}keyReleased(t){return this.mapKey[t]in this.keyUpInput&&this.keyUpInput[this.mapKey[t]]}}class lt{constructor(){this.mouseClickEventListener=t=>{const e=document.getElementById("game").getBoundingClientRect(),s=t.clientX-e.left,i=t.clientY-e.top;this.mousePosition=[s,i]},this.mousePosition=[-1,-1],document.getElementById("game").addEventListener("click",this.mouseClickEventListener)}clicked(t){return!!t.containsPoint(this.mousePosition)&&(this.mousePosition=[-1,-1],!0)}}class ct{constructor(){this.mouseInput=new lt,this.keyboardInput=new rt}setContext(t){this.context=t}}const ut=[70,500],pt=[590,0],dt=[580,0],yt=[60,650],gt=[350,650],mt=[0,0],ft=[0,0],bt=[0,750],Pt=[120,650],St=[100,100],Bt=[60,350],wt=[60,440],kt=[60,530];class vt extends ct{constructor(){super(),this.loadResources(),document.getElementById("game")}loadResources(){this.background=new D(o),this.background.setPosition([...mt]),this.topBackground=new D(n),this.topBackground.setPosition([...ft]),this.resumeButton=new q(m),this.resumeButton.scaleSize(1.2),this.resumeButton.setPosition([...pt])}render(){this.background.display(),this.topBackground.display(),this.resumeButton.display()}processInput(){this.mouseInput.clicked(this.resumeButton)&&this.context.transitionTo(new Yt)}update(t){}}class Ot extends V{constructor(t="0"){super(),this.text=t,this.font="DoodleJump",this.size=[0,30]}setText(t){this.text=t}getText(){return this.text}display(t=[0,0]){if(!this.visible)return;const e=document.getElementById("game").getContext("2d");e&&(e.font=this.size[1].toString()+"px "+this.font,e.fillText(this.text,this.position[0],this.position[1]))}}class It extends ct{constructor(){super(),this.dataManager=_.getInstance(),this.loadResources(),document.getElementById("game")}loadResources(){this.background=new D(i),this.background.setPosition([...mt]),this.topBackground=new D(n),this.topBackground.setPosition([...ft]),this.bottomBackground=new D(h),this.bottomBackground.setPosition([...bt]),this.gameOverBackground=new D(v),this.gameOverBackground.setPosition([...St]),this.score=this.dataManager.getScore(),this.highScore=this.dataManager.getHighScore(),this.playerName=this.dataManager.getPlayerName(),this.yourScoreObject=new Ot("YOUR SCORE: "+this.score.toString()),this.yourScoreObject.setPosition([...Bt]),this.yourScoreObject.setHeight(40),this.yourHighScoreObject=new Ot("YOUR HIGH SCORE: "+this.highScore.toString()),this.yourHighScoreObject.setPosition([...wt]),this.yourHighScoreObject.setHeight(40),this.yourNameObject=new Ot("YOUR NAME: "+this.playerName),this.yourNameObject.setPosition([...kt]),this.yourNameObject.setHeight(40),this.playAgainButton=new q(g),this.playAgainButton.setPosition([...yt]),this.menuButton=new q(O),this.menuButton.setPosition([...gt])}processInput(){this.mouseInput.clicked(this.playAgainButton)?(this.dataManager.reset(),this.context.transitionTo(new Yt)):this.mouseInput.clicked(this.menuButton)&&this.context.transitionTo(new Et)}update(t){}render(){this.background.display(),this.topBackground.display(),this.bottomBackground.display(),this.gameOverBackground.display(),this.playAgainButton.display(),this.menuButton.display(),this.yourScoreObject.display(),this.yourHighScoreObject.display(),this.yourNameObject.display()}}var Rt,zt;!function(t){t[t.NormalLand=0]="NormalLand",t[t.MovingLand=1]="MovingLand",t[t.DustLand=2]="DustLand"}(Rt||(Rt={})),function(t){t[t.None=0]="None",t[t.BlueWingsMonster=1]="BlueWingsMonster",t[t.AlienMonster=2]="AlienMonster"}(zt||(zt={}));class At extends Q{constructor(t){super(t),this.scaleSize(1.5)}onCollision(t){t.setState(H.Lose)}}const Lt=25,xt=[.15,0],Tt=[0,.8];class Ht extends D{constructor(){super(b),this.scaleSize(2),this.velocity=[...xt]}setPositionForBuff(){let t=ht.getInstance();this.buff.setPosition([this.position[0]+t.getRandomFloat(0,this.size[0]-this.buff.getWidth()),this.position[1]-this.buff.getHeight()])}randomizeBuff(){switch(ht.getInstance().getRandomInt(0,30)){case Z.Propeller:this.buff=new it,this.setPositionForBuff();break;case Z.Jetpack:this.buff=new ot,this.setPositionForBuff();break;case Z.Spring:this.buff=new nt,this.setPositionForBuff()}}move(t){let s=[0,0];this.buff&&(s=this.buff.getPosition()),this.position[0]>=e-this.size[0]?(s[0]-=this.position[0]-(e-this.size[0]),this.position[0]=e-this.size[0],this.velocity[0]=-this.velocity[0]):this.position[0]<=0&&(s[0]-=this.position[0],this.position[0]=0,this.velocity[0]=-this.velocity[0]),this.position[1]+=t*this.velocity[1],this.position[0]+=t*this.velocity[0],s[0]+=t*this.velocity[0],s[1]+=t*this.velocity[1]}onJumped(t){this.buff&&t.collides(this.buff)?this.buff.onReceived(t):(t.setVelocity([...j]),t.getState()!=H.ShootUp&&t.setState(H.Jump))}display(t){super.display(t),this.buff&&this.buff.display(t)}}class Mt extends Q{constructor(){super(P),this.velocity=[0,0],this.scaleSize(2)}onJumped(t){this.requestMultipleAnimation(1,3),this.velocity=[...Tt]}randomizeBuff(){}move(t){this.position[0]+=this.velocity[0]*t,this.position[1]+=this.velocity[1]*t,this.timePassed(t)}}const Vt=[.3,0],Dt=[.2,0];class Ft extends At{constructor(){super(I),this.velocity=[...Vt],this.requestLoopAnimation()}move(t){this.position[0]>=e-this.size[0]?(this.position[0]=e-this.size[0],this.velocity[0]=-this.velocity[0]):this.position[0]<=0&&(this.position[0]=0,this.velocity[0]=-this.velocity[0]),this.position[1]+=t*this.velocity[1],this.position[0]+=t*this.velocity[0]}}class jt extends At{constructor(){super(R),this.requestSingleAnimation(0),this.velocity=[...Dt]}move(t){this.position[0]>=e-this.size[0]?(this.position[0]=e-this.size[0],this.velocity[0]=-this.velocity[0],this.requestSingleAnimation(1)):this.position[0]<=0&&(this.position[0]=0,this.velocity[0]=-this.velocity[0],this.requestSingleAnimation(0)),this.position[1]+=t*this.velocity[1],this.position[0]+=t*this.velocity[0]}}class Yt extends ct{constructor(){super(),this.dataManager=_.getInstance(),this.loadResources(),this.shootAllowed=!0}loadResources(){this.temporaryPlayer=null,this.player=this.dataManager.getPlayer(),this.lands=this.dataManager.getLands(),this.monsters=this.dataManager.getMonsters(),this.bullets=this.dataManager.getBullets(),this.background=new D(i),this.background.setPosition([...mt]),this.topBackground=new D(n),this.topBackground.setPosition([...ft]),this.pauseButton=new q(y),this.pauseButton.scaleSize(1.5),this.pauseButton.setPosition([...dt]),this.camera=this.dataManager.getCamera(),this.score=this.dataManager.getScore(),this.scoreObject=new Ot(this.score.toString()),this.scoreObject.setPosition([0,50]),this.scoreObject.setHeight(50)}processInput(){this.mouseInputProcessing(),this.keyboardInputProcessing()}render(){const t=document.getElementById("game"),e=t.getContext("2d");if(!e)return;e.clearRect(0,0,t.width,t.height);let s=this.camera.getOffset();this.background.display(),this.lands.forEach((t=>{t.display(s)})),this.bullets.forEach((t=>{t.display(s)})),this.player.display(s),this.temporaryPlayer&&this.temporaryPlayer.display(s),this.monsters.forEach((t=>{t.display(s)})),this.topBackground.display(),this.pauseButton.display(),this.scoreObject.display()}update(t){if(this.checkCollidesMonster(),this.camera.isOutOfBottomRange(this.player)&&this.player.getState()==H.Fall||this.player.getState()==H.Lose)return this.dataManager.setScore(this.score),void this.context.transitionTo(new It);this.lands.forEach((t=>{if(this.player.getVelocityY()>0)if(this.player.standOn(t))t.onJumped(this.player);else if(this.temporaryPlayer&&this.temporaryPlayer.standOn(t)){t.onJumped(this.temporaryPlayer);let e=this.player.getPosition();this.player=this.temporaryPlayer.clone(),this.camera.focusOn(this.player),this.player.setPosition([...e])}})),this.updateMap(t),this.bullets.forEach((e=>{e.move(t)})),this.player.autoFall(t),this.score=Math.round(Math.max(this.score,Y[1]-this.player.getPositionY())),this.player.getPositionX()<0?this.player.getPositionX()+this.player.getWidth()>0?(this.temporaryPlayer=this.player.clone(),this.temporaryPlayer.setPositionX(this.player.getPositionX()+e)):(this.player=this.temporaryPlayer,this.camera.focusOn(this.player),this.temporaryPlayer=null):this.player.getPositionX()+this.player.getWidth()>e?this.player.getPositionX()<e?(this.temporaryPlayer=this.player.clone(),this.temporaryPlayer.setPositionX(this.player.getPositionX()-e)):(this.player=this.temporaryPlayer,this.camera.focusOn(this.player),this.temporaryPlayer=null):this.temporaryPlayer=null,this.scoreObject.setText(this.score.toString()),this.camera.update()}checkCollidesMonster(){for(let t=0;t<this.monsters.length;t++){for(let e=0;e<this.bullets.length;e++)if(this.monsters[t].collides(this.bullets[e]))return this.monsters.splice(t,1),void this.bullets.splice(e,1);if(this.monsters[t].collides(this.player))return void(this.player.standOn(this.monsters[t])&&this.player.getVelocityY()>0?(this.monsters.splice(t,1),this.player.setVelocity([...j]),this.temporaryPlayer&&this.temporaryPlayer.setVelocity([...j]),this.player.getState()!=H.ShootUp&&(this.player.setState(H.Jump),this.temporaryPlayer&&this.temporaryPlayer.setState(H.Jump))):this.player.setState(H.Lose))}}updateMap(s){for(;this.lands.length>0&&this.camera.isOutOfBottomRange(this.lands[0]);)this.lands.shift();for(;this.monsters.length>0&&(this.camera.isOutOfBottomRange(this.monsters[0])||this.player.getBuff());)this.monsters.shift();for(;this.bullets.length>0&&this.camera.isOutOfRange(this.bullets[0]);)this.bullets.shift();let i=ht.getInstance();for(;0==this.lands.length||this.lands[this.lands.length-1].getPositionY()-this.camera.getOffsetY()>=50;){let s=t;this.lands.length>0&&(s=this.lands[this.lands.length-1].getPositionY());let o=i.getRandomInt(0,3);switch(s-this.lastStandableLandHeight>=30&&(o=i.getRandomInt(0,1)),o){case Rt.NormalLand:{let t=new at;t.setPosition([i.getRandomFloat(0,e-t.getWidth()),i.getRandomFloat(s-Lt-20,s-Lt)]),t.randomizeBuff(),this.lastStandableLandHeight=t.getPositionY(),this.lands.push(t);break}case Rt.MovingLand:{let t=new Ht;t.setPosition([i.getRandomFloat(0,e-t.getWidth()),i.getRandomFloat(s-Lt-20,s-Lt)]),t.randomizeBuff(),this.lastStandableLandHeight=t.getPositionY(),this.lands.push(t);break}case Rt.DustLand:{let t=new Mt;t.setPosition([i.getRandomFloat(0,e-t.getWidth()),i.getRandomFloat(s-Lt-20,s-Lt)]),t.randomizeBuff(),this.lands.push(t);break}}}for(;(this.player.getState()==H.Jump||this.player.getState()==H.Fall)&&(0==this.monsters.length||this.monsters[this.monsters.length-1].getPositionY()-this.camera.getOffsetY()>=700);){let t=this.camera.getOffsetY();switch(this.monsters.length>0&&(t=this.monsters[this.monsters.length-1].getPositionY()),i.getRandomInt(0,3)){case zt.BlueWingsMonster:{let s=new Ft;s.setPosition([i.getRandomFloat(0,e-s.getWidth()),i.getRandomFloat(t-s.getHeight()-3e3,t-s.getHeight()-2e3)]),this.monsters.push(s);break}case zt.AlienMonster:let s=new jt;s.setPosition([i.getRandomFloat(0,e-s.getWidth()),i.getRandomFloat(t-s.getHeight()-3e3,t-s.getHeight()-2e3)]),this.monsters.push(s)}}this.lands.forEach((t=>{t.move(s)})),this.monsters.forEach((t=>{t.move(s),t.timePassed(s)}))}mouseInputProcessing(){this.mouseInput.clicked(this.pauseButton)&&(this.dataManager.setScore(this.score),this.context.transitionTo(new vt))}keyboardInputProcessing(){(this.keyboardInput.keyReleased("a")||this.keyboardInput.keyReleased("ArrowLeft")||this.keyboardInput.keyReleased("d")||this.keyboardInput.keyReleased("ArrowRight"))&&this.player.setVelocityX(0),(this.keyboardInput.keyReleased("w")||this.keyboardInput.keyReleased("ArrowUp"))&&(this.shootAllowed=!0),this.keyboardInput.keyDown("a")||this.keyboardInput.keyDown("ArrowLeft")?this.player.setVelocityDirection(M.Left):(this.keyboardInput.keyDown("d")||this.keyboardInput.keyDown("ArrowRight"))&&this.player.setVelocityDirection(M.Right),(this.keyboardInput.keyDown("w")||this.keyboardInput.keyDown("ArrowUp"))&&(this.player.getState()!=H.Fall&&this.player.getState()!=H.Jump&&this.player.getState()!=H.ShootUp||(this.shootAllowed&&(this.bullets.push(this.player.shoot([...W])),this.shootAllowed=!1),this.player.setState(H.ShootUp),this.player.setSpecialStateTime(300)))}}class Et extends ct{constructor(){super(),this.loadResources()}loadResources(){this.background=new D(a),this.background.setHeight(t),this.background.setPosition([...mt]),this.player=new U,this.player.setPosition([...J]),this.player.setVelocity([...E]),this.playButton=new q(d),this.playButton.setPosition([...ut]),this.land=new at,this.land.setPosition([...Pt])}processInput(){if(this.mouseInput.clicked(this.playButton)){let t=_.getInstance();t.reset(),t.getLands().push(this.land),t.setPlayer(this.player),this.context.transitionTo(new Yt)}}update(t){this.player.autoFallInStartScene(t),this.player.standOn(this.land)&&this.player.getState()==H.Fall&&this.land.onJumped(this.player)}render(){const t=document.getElementById("game"),e=t.getContext("2d");e&&(e.clearRect(0,0,t.width,t.height),this.background.display(),this.land.display(),this.player.display(),this.playButton.display())}}(new class extends x{constructor(){super();const s=document.getElementById("game");s.style.marginLeft="400px",s.width=e,s.height=t}run(){this.transitionTo(new Et),super.run()}}).run()})();